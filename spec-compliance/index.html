<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset=utf-8>
    <meta name="viewport" content="width=620">
    <title>iOS shim for HTML5 Drag and drop</title>
    <link rel="stylesheet" href="demo.css">
    <script src="demo.js"></script>
    <link rel="stylesheet" href="../mobile-drag-and-drop-polyfill.css">
    <script src="../mobile-drag-and-drop-polyfill.js"></script>
</head>
<body>
<section id="wrapper">
    <header>
        <h1>iOS shim for HTML5 Drag and drop</h1>
    </header>
    <article>
        <p>Drag the list items over the dustbin, and drop them to have the bin eat the item</p>

        <div id="bin">
            <div id="innerBin"></div>
        </div>
        <ul>
            <li><a id="one" href="#"><span style="display: inline-block; background: lightblue">one</span></a></li>
            <li><a href="#" id="two">two</a></li>
            <li><a href="#" id="three">three</a></li>
            <li><a href="#" id="four">four</a></li>
            <li><a href="#" id="five">five</a></li>
        </ul>
        <hr/>
        <h4>Text for dragging</h4>
        <label>
            <input type="text" value="test"/>
        </label>
        <label>
            <textarea>can u drag me?</textarea>
        </label>

        <p>some text that might be draggable when selected?</p>
        <hr/>
        <h4>Clickables</h4>
        <a href="#">Some test link</a>
        <a href="#" draggable="false">Another undraggable</a>
        <hr/>
        <h4>Draggables</h4>
        <a href="#" draggable="true">Draggable test link</a>
        <span draggable="true">Draggable span</span>

        <div draggable="true" style="width: 50px; height:50px; border:solid white 2px; background-color:black;"></div>
        <hr/>
        <h4>Notes</h4>
        <ol>
            <li>The blue bordered item ('one') is a child inside a draggable element. If you drag the child, we should still drag the whole element.</li>
        </ol>
    </article>
    <script>

        MobileDragAndDropPolyfill.Initialize({
            log: function () {

                var msg = "dnd-poly: ";
                for(var i = 0; i < arguments.length; i++) {
                    msg += arguments[i];
                }

                console.log(msg);
            }
        });

        var missed = ['hey!', 'missed it :(', 'that was close..', 'ARRRR'];
        var eat = ['yum!', 'gulp', 'burp!', 'nom'];
        var yum = document.createElement('p');
        var msie = /*@cc_on!@*/0;
        yum.style.opacity = 1;

        var links = document.querySelectorAll('li > a'), el = null;
        for (var i = 0; i < links.length; i++) {
            el = links[i];

            el.setAttribute('draggable', 'true');

            addEvent(el, 'dragstart', function (e) {

                console.log('dragstart');

                e.dataTransfer.effectAllowed = 'copy'; // only dropEffect='copy' will be dropable

                console.log('setting data: ' + this.id);

                e.dataTransfer.setData('Text', this.id); // required otherwise doesn't work
            });

            addEvent(el, 'drag', function (e) {

                console.log('drag');
            });

            addEvent(el, 'dragend', function (e) {

                console.log('dragend with effect: ' + e.dataTransfer.dropEffect);
            });

            addEvent(el, 'click', function (e) {

                console.log('clicked on draggable');
            });
        }

        var bin = document.querySelector('#bin');

        addEvent(document.body, 'dragover', function (e) {
            console.log('body dragover');
        });

        addEvent(document.body, 'dragexit', function (e) {
            console.log('body dragexit');
        });

        addEvent(document.body, 'drop', function (e) {
            console.log('body drop');
        });

        addEvent(document.body, 'dragleave', function (e) {
            console.log('body dragleave');
        });

        addEvent(bin, 'dragover', function (e) {
            console.log('bin dragover');

            e.preventDefault(); // allows us to drop
            e.dataTransfer.dropEffect = 'copy'; // we have to set it for firefox to be happy

            //    this.className = 'over';
            //    return false;
        });

        // to get IE to work
        addEvent(bin, 'dragenter', function (e) {
            console.log('bin dragenter');

            e.preventDefault();

            //    this.className = 'over';
            //    return false;
        });

        addEvent(bin, 'dragleave', function () {
            console.log('bin dragleave');
        });

        addEvent(bin, 'drop', function (e) {
            console.log('bin drop');

            if (e.stopPropagation) e.stopPropagation(); // stops the browser from redirecting...why???

            // stupid nom text + fade effect
            bin.className = '';
            yum.innerHTML = missed[parseInt(Math.random() * missed.length)];

            var y = yum.cloneNode(true);
            bin.appendChild(y);

            setTimeout(function () {
                var t = setInterval(function () {
                    if (y.style.opacity <= 0) {
                        if (msie) { // don't bother with the animation
                            y.style.display = 'none';
                        }
                        clearInterval(t);
                    } else {
                        y.style.opacity -= 0.1;
                    }
                }, 50);
            }, 250);

            return false;
        });

        var innerBin = document.querySelector('#innerBin');

        addEvent(innerBin, 'dragover', function (e) {
            e.preventDefault(); // allows us to drop
            e.dataTransfer.dropEffect = 'copy';

            console.log('apperture dragover');

            //    this.className = 'over';
            //    return false;
        });

        // to get IE to work
        addEvent(innerBin, 'dragenter', function (e) {
            e.preventDefault();
            console.log('apperture dragenter');

            //    this.className = 'over';
            //    return false;
        });

        addEvent(innerBin, 'dragleave', function (e) {
            console.log('apperture dragleave');

            this.className = '';
        });

        addEvent(innerBin, 'drop', function (e) {
            //    if (e.stopPropagation) e.stopPropagation(); // stops the browser from redirecting...why???
            console.log('apperture drop');

            var el = document.getElementById(e.dataTransfer.getData('Text'));

            el.parentNode.removeChild(el);

            // stupid nom text + fade effect
            bin.className = '';
            yum.innerHTML = eat[parseInt(Math.random() * eat.length)];

            var y = yum.cloneNode(true);
            bin.appendChild(y);

            setTimeout(function () {
                var t = setInterval(function () {
                    if (y.style.opacity <= 0) {
                        if (msie) { // don't bother with the animation
                            y.style.display = 'none';
                        }
                        clearInterval(t);
                    } else {
                        y.style.opacity -= 0.1;
                    }
                }, 50);
            }, 250);

            return false;
        });

    </script>
    <footer><a id="author" href="http://twitter.com/timruffles">@timruffles made this shim</a>/<a id="built" href="http://twitter.com/rem">original demo by
        @rem</a>/<a href="#view-source">source</a></footer>
</section>
<a href="https://github.com/timruffles/ios-html5-drag-drop-shim"><img style="position: absolute; top: 0; left: 0; border: 0;"
                                                                      src="http://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png"
                                                                      alt="Fork me on GitHub"/></a>

</body>
</html>


