/*! drag-drop-webkit-mobile 1.1.1 | Copyright (c) 2015 Tim Ruffles | BSD 2 License */
var MobileDragAndDropPolyfill;!function(a){a.Initialize=function(a){c.Initialize(a)};var b,c=function(){function a(){}return a.Initialize=function(b){g.Merge(a.config,b),a.IsDragAndDropSupportedNatively()||(a.config.log("Applying mobile drag and drop polyfill."),window.document.addEventListener("touchstart",a.OnTouchstart))},a.IsDragAndDropSupportedNatively=function(){var b=window.document.createElement("div"),c="draggable"in b,d="ondragstart"in b&&"ondrop"in b,e=/iPad|iPhone|iPod|Android/.test(navigator.userAgent);c&&a.config.log("draggable property is present"),d&&a.config.log("drag events are present"),window.MouseEvent&&"function"==typeof MouseEvent.constructor&&a.config.log("mouse event constructor is available"),window.DragEvent&&"function"==typeof DragEvent.constructor&&a.config.log("drag event constructor is available"),e&&a.config.log("user agent is known to need drag'n'drop polyfill");var f=!(c||d)||e;return!f},a.OnTouchstart=function(b){if(a.config.log("global touchstart"),a.dragOperationActive)return void a.config.log("drag operation already active");var c=d.IsDragOperation(b,a.config);if(c){b.preventDefault(),a.dragOperationActive=!0;try{new d(a.config,c,b,a.DragOperationEnded)}catch(e){a.config.log(e),a.DragOperationEnded()}}},a.DragOperationEnded=function(){a.dragOperationActive=!1},a.dragOperationActive=!1,a.config={log:function(){},dragImageClass:null,iterationInterval:150,coordinateSystemForElementFromPoint:"client"},a}(),d=function(){function a(a,b,c,d){this.config=a,this.sourceNode=b,this.dragOperationEndedCb=d,this.doc=window.document,this.dragImage=null,this.transformStyleMixins={},this.immediateUserSelection=null,this.currentDropTarget=null,this.dragDataStore=new f,this.dataTransfer=null,this.currentDragOperation="none",this.iterationLock=!1,this.intervalId=null,this.lastTouchEvent=null,this.initialDragTouchIdentifier=null,this.dragOperationEnded=!1,this.dragOperationCancelled=!1,this.dragImageDisplayCss=null,a.log("setting up potential drag operation.."),this.touchMoveHandler=this.onTouchMove.bind(this),this.touchEndOrCancelHandler=this.onTouchEndOrCancel.bind(this),this.snapbackEndedCb=this.snapbackTransitionEnded.bind(this),this.dataTransfer=new e(this.dragDataStore),this.lastTouchEvent=c,this.initialDragTouchIdentifier=this.lastTouchEvent.changedTouches[0].identifier,this.dragstart(this.sourceNode)?(a.log("dragstart cancelled"),this.cleanup()):this.setup()}return a.prototype.setup=function(){var a=this;this.config.log("setup"),this.createDragImage(this.lastTouchEvent),document.addEventListener("touchmove",this.touchMoveHandler),document.addEventListener("touchend",this.touchEndOrCancelHandler),document.addEventListener("touchcancel",this.touchEndOrCancelHandler),this.intervalId=setInterval(function(){return a.iterationLock?void a.config.log("iteration skipped because previous iteration hast not yet finished."):(a.iterationLock=!0,a.dragAndDropProcessModelIteration(),void(a.iterationLock=!1))},this.config.iterationInterval)},a.prototype.cleanup=function(){this.config.log("cleanup"),this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),document.removeEventListener("touchmove",this.touchMoveHandler),document.removeEventListener("touchend",this.touchEndOrCancelHandler),document.removeEventListener("touchcancel",this.touchEndOrCancelHandler),null!=this.dragImage&&(this.dragImage.parentNode.removeChild(this.dragImage),this.dragImage=null),this.doc=null,this.immediateUserSelection=null,this.dataTransfer=null,this.currentDropTarget=null,this.dragDataStore=null,this.lastTouchEvent=null,this.touchEndOrCancelHandler=null,this.touchMoveHandler=null,this.snapbackEndedCb=null,this.dragOperationEndedCb()},a.prototype.onTouchMove=function(a){if(g.IsTouchIdentifierContainedInTouchEvent(a,this.initialDragTouchIdentifier)!==!1){a.preventDefault(),a.stopImmediatePropagation(),this.lastTouchEvent=a;var b=[],c=[];[].forEach.call(a.changedTouches,function(a,d){b.push(a.pageX),c.push(a.pageY)});var d=g.Average(b)-parseInt(this.dragImage.offsetWidth,10)/2,e=g.Average(c)-parseInt(this.dragImage.offsetHeight,10)/2;this.translateDragImage(d,e)}},a.prototype.onTouchEndOrCancel=function(a){g.IsTouchIdentifierContainedInTouchEvent(a,this.initialDragTouchIdentifier)!==!1&&(a.preventDefault(),a.stopImmediatePropagation(),this.config.log("touch cancelled or ended"),this.lastTouchEvent=a,this.dragOperationEnded=!0,this.dragOperationCancelled="touchcancel"===a.type)},a.PrepareNodeCopyAsDragImage=function(b,c){if(1===b.nodeType&&(c.removeAttribute("id"),c.removeAttribute("draggable")),b.hasChildNodes())for(var d=0;d<b.childNodes.length;d++)a.PrepareNodeCopyAsDragImage(b.childNodes[d],c.childNodes[d])},a.prototype.createDragImage=function(b){var c=this;this.dragImage=this.sourceNode.cloneNode(!0),a.PrepareNodeCopyAsDragImage(this.sourceNode,this.dragImage),this.dragImage.style.position="absolute",this.dragImage.style.left="0px",this.dragImage.style.top="0px",this.dragImage.style["z-index"]="999999",this.dragImage.style["pointer-events"]="none",a.transform_css_vendor_prefixes.forEach(function(b){var d=b+"transform",e=c.dragImage.style[d];"undefined"!=typeof e&&("none"!==e?c.transformStyleMixins[d]=e.replace(a.transform_css_regex,""):c.transformStyleMixins[d]="")}),this.dragImage.classList.add("mobile-dnd-poly-drag-image"),this.config.dragImageClass&&this.dragImage.classList.add(this.config.dragImageClass);var d=[],e=[];[].forEach.call(b.changedTouches,function(a,b){d.push(a.pageX),e.push(a.pageY)});var f=g.Average(d)-parseInt(this.sourceNode.offsetWidth,10)/2,h=g.Average(e)-parseInt(this.sourceNode.offsetHeight,10)/2;this.translateDragImage(f,h),this.sourceNode.parentNode.insertBefore(this.dragImage,this.sourceNode.nextSibling)},a.prototype.hideDragImage=function(){this.dragImage&&"none"!=this.dragImage.style.display&&(this.dragImageDisplayCss=this.dragImage.style.display,this.dragImage.style.display="none")},a.prototype.showDragImage=function(){this.dragImage&&(this.dragImage.style.display=this.dragImageDisplayCss?this.dragImageDisplayCss:"block")},a.prototype.translateDragImage=function(a,b){var c=this,d=" translate3d("+a+"px,"+b+"px, 0)";g.ForIn(this.transformStyleMixins,function(a,b){c.dragImage.style[b]=a+d})},a.prototype.snapbackDragImage=function(){this.config.log("starting dragimage snap back"),this.dragImage.addEventListener("transitionend",this.snapbackEndedCb),this.dragImage.addEventListener("webkitTransitionEnd",this.snapbackEndedCb),this.dragImage.classList.add("snapback");var a,b,c=this.sourceNode.getBoundingClientRect(),d=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,e=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft;b=c.top+d,a=c.left+e;var f=window.getComputedStyle(this.sourceNode,null),g=parseInt(f.getPropertyValue("padding-left"),10),h=parseInt(f.getPropertyValue("padding-top"),10);a-=g,b-=h,this.translateDragImage(a,b)},a.prototype.snapbackTransitionEnded=function(){this.config.log("dragimage snap back transition ended"),this.dragImage.removeEventListener("transitionend",this.snapbackEndedCb),this.dragImage.removeEventListener("webkitTransitionEnd",this.snapbackEndedCb),this.dragend(this.sourceNode),this.cleanup()},a.IsDragOperation=function(a,b){b.log("detecting possible drag operation..");var c=a.target;do if(c.draggable!==!1){if("A"==c.tagName&&!c.getAttribute("draggable")){var d=g.CreateMouseEventFromTouch(a,"click");b.log("dispatching click on anchor");var e=c.dispatchEvent(d);if(!e)return a.preventDefault(),null}if(c.getAttribute("draggable"))return b.log("drag on tag"),c}while((c=c.parentNode)&&c!==window.document.body)},a.prototype.dragAndDropProcessModelIteration=function(){var b=this.drag(this.sourceNode);if(b&&(this.config.log("drag event cancelled."),this.currentDragOperation="none"),b||this.dragOperationEnded){var c=this.DragOperationEnded(this.dragOperationCancelled);return c?void this.snapbackDragImage():(this.dragend(this.sourceNode),void this.cleanup())}var d=g.GetTouchContainedInTouchEventByIdentifier(this.lastTouchEvent,this.initialDragTouchIdentifier);if(!d)return void this.config.log("touch event that did not contain initial drag operation touch slipped through");var e=g.ElementFromTouch(this.doc,d),f=this.currentDropTarget;e!==this.immediateUserSelection&&e!==this.currentDropTarget&&(this.immediateUserSelection=e,null===this.immediateUserSelection?(this.currentDropTarget=this.immediateUserSelection,this.config.log("current drop target changed to null")):this.dragenter(this.immediateUserSelection)?(this.config.log("dragenter default prevented"),this.currentDropTarget=this.immediateUserSelection,this.currentDragOperation=a.DetermineDragOperation(this.dataTransfer)):(this.config.log("dragenter not prevented"),"none"!==a.GetOperationForMatchingDropzone(this.immediateUserSelection,this.dragDataStore)?this.currentDropTarget=this.immediateUserSelection:this.immediateUserSelection===this.doc.body||(this.currentDropTarget=this.doc.body))),f!==this.currentDropTarget&&g.IsDOMElement(f)&&(this.config.log("current drop target changed."),this.dragleave(f)),g.IsDOMElement(this.currentDropTarget)&&(this.dragover(this.currentDropTarget)===!1?(this.config.log("dragover not prevented. checking for dom element with dropzone-attr"),this.currentDragOperation=a.GetOperationForMatchingDropzone(this.currentDropTarget,this.dragDataStore)):(this.config.log("dragover prevented -> valid drop target?"),this.currentDragOperation=a.DetermineDragOperation(this.dataTransfer),this.config.log("current drag operation after dragover: "+this.currentDragOperation))),this.config.log("d'n'd iteration ended. current drag operation: "+this.currentDragOperation),this.dragImage.classList.remove("copy"),this.dragImage.classList.remove("link"),this.dragImage.classList.remove("move"),this.dragImage.classList.remove("none"),this.dragImage.classList.add(this.currentDragOperation)},a.prototype.DragOperationEnded=function(a){this.config.log("drag operation end detected. cancelled: "+!!a);var b="none"===this.currentDragOperation||null===this.currentDropTarget||a;return b?g.IsDOMElement(this.currentDropTarget)&&this.dragleave(this.currentDropTarget):g.IsDOMElement(this.currentDropTarget)&&(this.drop(this.currentDropTarget)===!0?this.currentDragOperation=this.dataTransfer.dropEffect:this.currentDragOperation="none"),b},a.DetermineDragOperation=function(a){if("uninitialized"===a.effectAllowed||"all"===a.effectAllowed)return a.dropEffect;if("copy"===a.dropEffect){if(0===a.effectAllowed.indexOf("copy"))return"copy"}else if("link"===a.dropEffect){if(0===a.effectAllowed.indexOf("link")||a.effectAllowed.indexOf("Link")>-1)return"link"}else if("move"===a.dropEffect&&(0===a.effectAllowed.indexOf("move")||a.effectAllowed.indexOf("Move")>-1))return"link";return"none"},a.DetermineDropEffect=function(a,b){return"none"===a?"none":0===a.indexOf("copy")||"all"===a?"copy":0===a.indexOf("link")?"link":"move"===a?"move":"uninitialized"===a&&3===b.nodeType&&"A"===b.tagName?"link":"copy"},a.GetOperationForMatchingDropzone=function(a,b){var c=a.getAttribute("dropzone");if(!c)return"none";for(var d,e=!1,f=c.split(" "),g=0;g<f.length;g++){var h=f[g];if("copy"!==h&&"move"!==h&&"link"!==h){if(!(h.length<3||":"!==h[1])){var i=h.split(":"),j=(i[0].toLowerCase(),i[1].toLowerCase());b.types.indexOf(j)>-1&&(e=!0)}}else d||(d=h)}return e?d?d:"copy":"none"},a.prototype.dragstart=function(a){this.config.log("dragstart"),this.dragDataStore.mode=b.READWRITE,this.dataTransfer.dropEffect="none";var c=g.CreateDragEventFromTouch(this.lastTouchEvent,"dragstart",!0,this.doc.defaultView,this.dataTransfer,null),d=!a.dispatchEvent(c);return this.dragDataStore.mode=b._DISCONNECTED,d},a.prototype.drag=function(a){this.config.log("drag"),this.dragDataStore.mode=b.PROTECTED,this.dataTransfer.dropEffect="none";var c=g.CreateDragEventFromTouch(this.lastTouchEvent,"drag",!0,this.doc.defaultView,this.dataTransfer,null),d=!a.dispatchEvent(c);return this.dragDataStore.mode=b._DISCONNECTED,d},a.prototype.dragenter=function(c){this.config.log("dragenter"),this.dragDataStore.mode=b.PROTECTED,this.dataTransfer.dropEffect=a.DetermineDropEffect(this.dragDataStore.effectAllowed,this.sourceNode);var d=g.CreateDragEventFromTouch(this.lastTouchEvent,"dragenter",!0,this.doc.defaultView,this.dataTransfer,this.currentDropTarget),e=!c.dispatchEvent(d);return this.dragDataStore.mode=b._DISCONNECTED,e},a.prototype.dragover=function(c){this.config.log("dragover"),this.dragDataStore.mode=b.PROTECTED,this.dataTransfer.dropEffect=a.DetermineDropEffect(this.dragDataStore.effectAllowed,this.sourceNode);var d=g.CreateDragEventFromTouch(this.lastTouchEvent,"dragover",!0,this.doc.defaultView,this.dataTransfer,null),e=!c.dispatchEvent(d);return this.dragDataStore.mode=b._DISCONNECTED,e},a.prototype.dragleave=function(a){this.config.log("dragleave"),this.dragDataStore.mode=b.PROTECTED;var c=g.CreateDragEventFromTouch(this.lastTouchEvent,"dragleave",!1,this.doc.defaultView,this.dataTransfer,null),d=!a.dispatchEvent(c);return this.dragDataStore.mode=b._DISCONNECTED,d},a.prototype.dragexit=function(a){this.config.log("dragexit"),this.dragDataStore.mode=b.PROTECTED;var c=g.CreateDragEventFromTouch(this.lastTouchEvent,"dragexit",!1,this.doc.defaultView,this.dataTransfer,null),d=!a.dispatchEvent(c);return this.dragDataStore.mode=b._DISCONNECTED,d},a.prototype.dragend=function(a){this.config.log("dragend"),this.dragDataStore.mode=b.PROTECTED,this.dataTransfer.dropEffect=this.currentDragOperation;var c=g.CreateDragEventFromTouch(this.lastTouchEvent,"dragend",!1,this.doc.defaultView,this.dataTransfer,null),d=!a.dispatchEvent(c);return this.dragDataStore.mode=b._DISCONNECTED,d},a.prototype.drop=function(a){this.config.log("drop"),this.dragDataStore.mode=b.READONLY,this.dataTransfer.dropEffect=this.currentDragOperation;var c=g.CreateDragEventFromTouch(this.lastTouchEvent,"drop",!1,this.doc.defaultView,this.dataTransfer,null),d=!a.dispatchEvent(c);return this.dragDataStore.mode=b._DISCONNECTED,d},a.transform_css_vendor_prefixes=["","-webkit-"],a.transform_css_regex=/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,a}(),e=function(){function a(a){this.dataStore=a,this._dropEffect="none"}return Object.defineProperty(a.prototype,"files",{get:function(){return this.dataStore.mode===b._DISCONNECTED,null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"items",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"types",{get:function(){return this.dataStore.mode===b._DISCONNECTED?null:Object.freeze(this.dataStore.types)},enumerable:!0,configurable:!0}),a.prototype.setData=function(a,c){if(this.dataStore.mode!==b._DISCONNECTED&&this.dataStore.mode===b.READWRITE){this.dataStore.data[a]=c;var d=this.dataStore.types.indexOf(a);d>-1&&this.dataStore.types.push(a)}},a.prototype.getData=function(a){return this.dataStore.mode===b._DISCONNECTED?null:this.dataStore.mode===b.PROTECTED?null:this.dataStore.data[a]||""},a.prototype.clearData=function(a){if(this.dataStore.mode!==b._DISCONNECTED){if(a&&this.dataStore.data[a]){delete this.dataStore.data[a];var c=this.dataStore.types.indexOf(a);return void(c>-1&&this.dataStore.types.splice(c,1))}this.dataStore.data={},this.dataStore.types=[]}},a.prototype.setDragImage=function(){return this.dataStore.mode===b._DISCONNECTED?null:void 0},Object.defineProperty(a.prototype,"effectAllowed",{get:function(){return this.dataStore.effectAllowed},set:function(c){this.dataStore.mode!==b._DISCONNECTED&&-1!==a.AllowedEffects.indexOf(c)&&(this.dataStore.effectAllowed=c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(c){this.dataStore.mode!==b._DISCONNECTED&&-1!==a.DropEffects.indexOf(c)&&(this._dropEffect=c)},enumerable:!0,configurable:!0}),a.AllowedEffects=["none","copy","copyLink","copyMove","link","linkMove","move","all"],a.DropEffects=["none","copy","move","link"],a}();!function(a){a[a._DISCONNECTED=0]="_DISCONNECTED",a[a.READONLY=1]="READONLY",a[a.READWRITE=2]="READWRITE",a[a.PROTECTED=3]="PROTECTED"}(b||(b={}));var f=function(){function a(){this.mode=b.PROTECTED,this.data={},this.types=[],this.effectAllowed="uninitialized"}return a}(),g=function(){function a(){}return a.ForIn=function(a,b){for(var c in a)a.hasOwnProperty(c)!==!1&&b(a[c],c)},a.Merge=function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)!==!1&&(a[c]=b[c])},a.Average=function(a){return 0===a.length?0:a.reduce(function(a,b){return b+a},0)/a.length},a.IsDOMElement=function(a){return a&&a.tagName},a.IsTouchIdentifierContainedInTouchEvent=function(a,b){for(var c=0;c<a.changedTouches.length;c++){var d=a.changedTouches[c];if(d.identifier===b)return!0}return!1},a.GetTouchContainedInTouchEventByIdentifier=function(a,b){for(var c=0;c<a.changedTouches.length;c++){var d=a.changedTouches[c];if(d.identifier===b)return d}return null},a.CreateMouseEventFromTouch=function(a,b,c,d,e){void 0===c&&(c=!0),void 0===d&&(d=document.defaultView),void 0===e&&(e=null);var f=document.createEvent("MouseEvents"),g=a.changedTouches[0];return f.initMouseEvent(b,!0,c,d,1,g.screenX,g.screenY,g.clientX,g.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,e),f},a.CreateDragEventFromTouch=function(a,b,c,d,e,f){void 0===f&&(f=null);var g=a.changedTouches[0],h=document.createEvent("Event");return h.initEvent(b,!0,c),h.dataTransfer=e,h.relatedTarget=f,h.screenX=g.screenX,h.screenY=g.screenY,h.clientX=g.clientX,h.clientY=g.clientY,h},a.ElementFromTouch=function(a,b){var c=a.elementFromPoint(b.clientX,b.clientY);return c},a}()}(MobileDragAndDropPolyfill||(MobileDragAndDropPolyfill={}));
//# sourceMappingURL=mobile-drag-and-drop-polyfill.min.map