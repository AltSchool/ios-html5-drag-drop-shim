/*! drag-drop-webkit-mobile 2.0.0 | Copyright (c) 2015 Tim Ruffles | BSD 2 License */
var MobileDragAndDropPolyfill;!function(a){a.Initialize=function(a){c.Initialize(a)};var b,c=function(){function a(){}return a.Initialize=function(b){h.Merge(a.config,b);var c={};a.IsDragAndDropSupportedNatively(c)||(a.config.log("Applying mobile drag and drop polyfill."),window.document.addEventListener("touchstart",a.OnTouchstart))},a.IsDragAndDropSupportedNatively=function(b){return b.draggable="draggable"in window.document.documentElement,b.dragEvents="ondragstart"in window.document.documentElement,b.touchEvents="ontouchstart"in window.document.documentElement,b.mouseEventConstructor="MouseEvent"in window,b.dragEventConstructor="DragEvent"in window,b.customEventConstructor="CustomEvent"in window,b.isBlinkEngine=!!window.chrome||/chrome/i.test(navigator.userAgent),b.isGeckoEngine=/firefox/i.test(navigator.userAgent),b.userAgentNotSupportingNativeDnD=/iPad|iPhone|iPod|Android/.test(navigator.userAgent)||b.touchEvents&&b.isBlinkEngine,h.ForIn(b,function(b,c){a.config.log("feature '"+c+"' is '"+b+"'")}),b.userAgentNotSupportingNativeDnD===!1&&b.draggable&&b.dragEvents},a.OnTouchstart=function(c){if(a.config.log("global touchstart"),a.dragOperationActive)return void a.config.log("drag operation already active");var d=a.TargetIsDraggable(c,a.config);if(d){c.preventDefault(),a.dragOperationActive=!0;try{new e(a.config,d,c,a.DragOperationEnded)}catch(f){a.config.log(f),a.DragOperationEnded(d,c,b.CANCELLED)}}},a.TargetIsDraggable=function(a,b){var c=a.target;do if(c.draggable!==!1&&"true"===c.getAttribute("draggable"))return c;while((c=c.parentNode)&&c!==window.document.body)},a.DragOperationEnded=function(c,d,e){if(a.dragOperationActive=!1,e===b.POTENTIAL){a.config.log("No movement on draggable. Dispatching click..");var f=h.CreateMouseEventFromTouch(d,"click");c.dispatchEvent(f)}},a.dragOperationActive=!1,a.config={log:function(){},dragImageClass:null,iterationInterval:150},a}();!function(a){a[a.POTENTIAL=0]="POTENTIAL",a[a.STARTED=1]="STARTED",a[a.ENDED=2]="ENDED",a[a.CANCELLED=3]="CANCELLED"}(b||(b={}));var d,e=function(){function a(a,c,d,e){this.config=a,this.sourceNode=c,this.dragOperationEndedCb=e,this.doc=window.document,this.dragImage=null,this.transformStyleMixins={},this.immediateUserSelection=null,this.currentDropTarget=null,this.dragDataStore=null,this.dataTransfer=null,this.currentDragOperation="none",this.iterationLock=!1,this.intervalId=null,this.lastTouchEvent=null,this.initialDragTouchIdentifier=null,this.dragOperationState=b.POTENTIAL,a.log("setting up potential drag operation.."),this.touchMoveHandler=this.onTouchMove.bind(this),this.touchEndOrCancelHandler=this.onTouchEndOrCancel.bind(this),this.lastTouchEvent=d,this.initialDragTouchIdentifier=this.lastTouchEvent.changedTouches[0].identifier,document.addEventListener("touchmove",this.touchMoveHandler),document.addEventListener("touchend",this.touchEndOrCancelHandler),document.addEventListener("touchcancel",this.touchEndOrCancelHandler)}return a.prototype.setupDragAndDropOperation=function(){var a=this;return this.config.log("starting drag and drop operation"),this.dragOperationState=b.STARTED,this.dragDataStore=new g,this.dataTransfer=new f(this.dragDataStore),this.createDragImage(this.lastTouchEvent),this.dragstart(this.sourceNode)?(this.config.log("dragstart cancelled"),this.dragOperationState=b.CANCELLED,void this.cleanup()):(this.snapbackEndedCb=this.snapbackTransitionEnded.bind(this),void(this.intervalId=setInterval(function(){return a.iterationLock?void a.config.log("iteration skipped because previous iteration hast not yet finished."):(a.iterationLock=!0,a.dragAndDropProcessModelIteration(),void(a.iterationLock=!1))},this.config.iterationInterval)))},a.prototype.cleanup=function(){this.config.log("cleanup"),this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),document.removeEventListener("touchmove",this.touchMoveHandler),document.removeEventListener("touchend",this.touchEndOrCancelHandler),document.removeEventListener("touchcancel",this.touchEndOrCancelHandler),null!=this.dragImage&&(this.dragImage.parentNode.removeChild(this.dragImage),this.dragImage=null),this.dataTransfer=null,this.dragDataStore=null,this.immediateUserSelection=null,this.currentDropTarget=null,this.touchEndOrCancelHandler=null,this.touchMoveHandler=null,this.snapbackEndedCb=null,this.dragOperationEndedCb(this.sourceNode,this.lastTouchEvent,this.dragOperationState),this.lastTouchEvent=null},a.prototype.onTouchMove=function(a){if(h.IsTouchIdentifierContainedInTouchEvent(a,this.initialDragTouchIdentifier)!==!1){if(this.dragOperationState===b.POTENTIAL)return void this.setupDragAndDropOperation();a.preventDefault(),a.stopImmediatePropagation(),this.lastTouchEvent=a;var c=[],d=[];[].forEach.call(a.changedTouches,function(a,b){c.push(a.pageX),d.push(a.pageY)});var e=h.Average(c)-parseInt(this.dragImage.offsetWidth,10)/2,f=h.Average(d)-parseInt(this.dragImage.offsetHeight,10)/2;this.translateDragImage(e,f)}},a.prototype.onTouchEndOrCancel=function(a){if(h.IsTouchIdentifierContainedInTouchEvent(a,this.initialDragTouchIdentifier)!==!1){if(this.dragOperationState===b.POTENTIAL)return void this.cleanup();a.preventDefault(),a.stopImmediatePropagation(),this.config.log("touch cancelled or ended"),this.lastTouchEvent=a,this.dragOperationState="touchcancel"===a.type?b.CANCELLED:b.ENDED}},a.PrepareNodeCopyAsDragImage=function(b,c){if(1===b.nodeType&&(c.removeAttribute("id"),c.removeAttribute("draggable")),b.hasChildNodes())for(var d=0;d<b.childNodes.length;d++)a.PrepareNodeCopyAsDragImage(b.childNodes[d],c.childNodes[d])},a.prototype.createDragImage=function(b){var c=this;this.dragImage=this.sourceNode.cloneNode(!0),a.PrepareNodeCopyAsDragImage(this.sourceNode,this.dragImage),this.dragImage.style.position="absolute",this.dragImage.style.left="0px",this.dragImage.style.top="0px",this.dragImage.style["z-index"]="999999",this.dragImage.style["pointer-events"]="none",a.transform_css_vendor_prefixes.forEach(function(b){var d=b+"transform",e=c.dragImage.style[d];"undefined"!=typeof e&&("none"!==e?c.transformStyleMixins[d]=e.replace(a.transform_css_regex,""):c.transformStyleMixins[d]="")}),this.dragImage.classList.add("mobile-dnd-poly-drag-image"),this.config.dragImageClass&&this.dragImage.classList.add(this.config.dragImageClass);var d=[],e=[];[].forEach.call(b.changedTouches,function(a,b){d.push(a.pageX),e.push(a.pageY)});var f=h.Average(d)-parseInt(this.sourceNode.offsetWidth,10)/2,g=h.Average(e)-parseInt(this.sourceNode.offsetHeight,10)/2;this.translateDragImage(f,g),this.sourceNode.parentNode.insertBefore(this.dragImage,this.sourceNode.nextSibling)},a.prototype.translateDragImage=function(a,b){var c=this,d=" translate3d("+a+"px,"+b+"px, 0)";h.ForIn(this.transformStyleMixins,function(a,b){c.dragImage.style[b]=a+d})},a.prototype.snapbackDragImage=function(){this.config.log("starting dragimage snap back"),this.dragImage.addEventListener("transitionend",this.snapbackEndedCb),this.dragImage.addEventListener("webkitTransitionEnd",this.snapbackEndedCb),this.dragImage.classList.add("snapback");var a,b,c=this.sourceNode.getBoundingClientRect(),d=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,e=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft;b=c.top+d,a=c.left+e;var f=window.getComputedStyle(this.sourceNode,null),g=parseInt(f.getPropertyValue("padding-left"),10),h=parseInt(f.getPropertyValue("padding-top"),10);a-=g,b-=h,this.translateDragImage(a,b)},a.prototype.snapbackTransitionEnded=function(){this.config.log("dragimage snap back transition ended"),this.dragImage.removeEventListener("transitionend",this.snapbackEndedCb),this.dragImage.removeEventListener("webkitTransitionEnd",this.snapbackEndedCb),this.dragend(this.sourceNode),this.dragOperationState=b.ENDED,this.cleanup()},a.prototype.dragAndDropProcessModelIteration=function(){var c=this.drag(this.sourceNode);if(c&&(this.config.log("drag event cancelled."),this.currentDragOperation="none"),c||this.dragOperationState===b.ENDED||this.dragOperationState===b.CANCELLED){var d=this.DragOperationEnded(this.dragOperationState);return d?void this.snapbackDragImage():(this.dragend(this.sourceNode),this.dragOperationState=b.ENDED,void this.cleanup())}var e=h.GetTouchContainedInTouchEventByIdentifier(this.lastTouchEvent,this.initialDragTouchIdentifier);if(!e)return void this.config.log("touch event that did not contain initial drag operation touch slipped through");var f=h.ElementFromTouch(this.doc,e),g=this.currentDropTarget;if(f!==this.immediateUserSelection&&f!==this.currentDropTarget)if(this.immediateUserSelection=f,null!==this.currentDropTarget&&this.dragexit(this.currentDropTarget),null===this.immediateUserSelection)this.currentDropTarget=this.immediateUserSelection,this.config.log("current drop target changed to null");else if(this.dragenter(this.immediateUserSelection))this.config.log("dragenter default prevented"),this.currentDropTarget=this.immediateUserSelection,this.currentDragOperation=a.DetermineDragOperation(this.dataTransfer);else{this.config.log("dragenter not prevented, searching for dropzone..");var i=a.FindDropzoneElement(this.immediateUserSelection);i===this.immediateUserSelection&&"none"!==a.GetOperationForMatchingDropzone(this.immediateUserSelection,this.dragDataStore)?this.currentDropTarget=this.immediateUserSelection:null!==i&&a.GetOperationForMatchingDropzone(i,this.dragDataStore)?(this.dragenter(i,this.currentDropTarget),this.currentDropTarget=i):this.immediateUserSelection===this.doc.body||(this.currentDropTarget=this.doc.body)}g!==this.currentDropTarget&&h.IsDOMElement(g)&&(this.config.log("current drop target changed."),this.dragleave(g,this.currentDropTarget)),h.IsDOMElement(this.currentDropTarget)&&(this.dragover(this.currentDropTarget)===!1?(this.config.log("dragover not prevented. checking for dom element with dropzone-attr"),this.currentDragOperation=a.GetOperationForMatchingDropzone(this.currentDropTarget,this.dragDataStore)):(this.config.log("dragover prevented -> valid drop target?"),this.currentDragOperation=a.DetermineDragOperation(this.dataTransfer),this.config.log("current drag operation after dragover: "+this.currentDragOperation))),this.config.log("d'n'd iteration ended. current drag operation: "+this.currentDragOperation),this.dragImage.classList.remove("copy"),this.dragImage.classList.remove("link"),this.dragImage.classList.remove("move"),this.dragImage.classList.remove("none"),this.dragImage.classList.add(this.currentDragOperation)},a.prototype.DragOperationEnded=function(a){this.config.log("drag operation end detected. state: "+b[a]);var c="none"===this.currentDragOperation||null===this.currentDropTarget||a===b.CANCELLED;return c?h.IsDOMElement(this.currentDropTarget)&&this.dragleave(this.currentDropTarget):h.IsDOMElement(this.currentDropTarget)&&(this.drop(this.currentDropTarget)===!0?this.currentDragOperation=this.dataTransfer.dropEffect:this.currentDragOperation="none"),c},a.DetermineDragOperation=function(a){if("uninitialized"===a.effectAllowed||"all"===a.effectAllowed)return a.dropEffect;if("copy"===a.dropEffect){if(0===a.effectAllowed.indexOf("copy"))return"copy"}else if("link"===a.dropEffect){if(0===a.effectAllowed.indexOf("link")||a.effectAllowed.indexOf("Link")>-1)return"link"}else if("move"===a.dropEffect&&(0===a.effectAllowed.indexOf("move")||a.effectAllowed.indexOf("Move")>-1))return"link";return"none"},a.DetermineDropEffect=function(a,b){return"none"===a?"none":0===a.indexOf("copy")||"all"===a?"copy":0===a.indexOf("link")?"link":"move"===a?"move":"uninitialized"===a&&3===b.nodeType&&"A"===b.tagName?"link":"copy"},a.FindDropzoneElement=function(b){return b.hasAttribute("dropzone")?b:b===window.document.body?null:a.FindDropzoneElement(b.parentElement)},a.GetOperationForMatchingDropzone=function(a,b){var c=a.getAttribute("dropzone");if(!c)return"none";for(var d,e=!1,f=c.split(" "),g=0;g<f.length;g++){var h=f[g];if("copy"!==h&&"move"!==h&&"link"!==h){if(!(h.length<3||":"!==h[1])){var i=h.split(":"),j=(i[0].toLowerCase(),i[1].toLowerCase());b.types.indexOf(j)>-1&&(e=!0)}}else d||(d=h)}return e?d?d:"copy":"none"},a.prototype.dragstart=function(a){this.config.log("dragstart"),this.dragDataStore.mode=d.READWRITE,this.dataTransfer.dropEffect="none";var b=h.CreateDragEventFromTouch(this.lastTouchEvent,"dragstart",!0,this.doc.defaultView,this.dataTransfer,null),c=!a.dispatchEvent(b);return this.dragDataStore.mode=d._DISCONNECTED,c},a.prototype.drag=function(a){this.config.log("drag"),this.dragDataStore.mode=d.PROTECTED,this.dataTransfer.dropEffect="none";var b=h.CreateDragEventFromTouch(this.lastTouchEvent,"drag",!0,this.doc.defaultView,this.dataTransfer,null),c=!a.dispatchEvent(b);return this.dragDataStore.mode=d._DISCONNECTED,c},a.prototype.dragenter=function(b,c){void 0===c&&(c=null),this.config.log("dragenter"),this.dragDataStore.mode=d.PROTECTED,this.dataTransfer.dropEffect=a.DetermineDropEffect(this.dragDataStore.effectAllowed,this.sourceNode);var e=h.CreateDragEventFromTouch(this.lastTouchEvent,"dragenter",!0,this.doc.defaultView,this.dataTransfer,c),f=!b.dispatchEvent(e);return this.dragDataStore.mode=d._DISCONNECTED,f},a.prototype.dragover=function(b){this.config.log("dragover"),this.dragDataStore.mode=d.PROTECTED,this.dataTransfer.dropEffect=a.DetermineDropEffect(this.dragDataStore.effectAllowed,this.sourceNode);var c=h.CreateDragEventFromTouch(this.lastTouchEvent,"dragover",!0,this.doc.defaultView,this.dataTransfer,null),e=!b.dispatchEvent(c);return this.dragDataStore.mode=d._DISCONNECTED,e},a.prototype.dragexit=function(a){this.config.log("dragexit"),this.dragDataStore.mode=d.PROTECTED,this.dataTransfer.dropEffect="none";var b=h.CreateDragEventFromTouch(this.lastTouchEvent,"dragexit",!1,this.doc.defaultView,this.dataTransfer,null),c=!a.dispatchEvent(b);return this.dragDataStore.mode=d._DISCONNECTED,c},a.prototype.dragleave=function(a,b){void 0===b&&(b=null),this.config.log("dragleave"),this.dragDataStore.mode=d.PROTECTED,this.dataTransfer.dropEffect="none";var c=h.CreateDragEventFromTouch(this.lastTouchEvent,"dragleave",!1,this.doc.defaultView,this.dataTransfer,b),e=!a.dispatchEvent(c);return this.dragDataStore.mode=d._DISCONNECTED,e},a.prototype.dragend=function(a){this.config.log("dragend"),this.dragDataStore.mode=d.PROTECTED,this.dataTransfer.dropEffect=this.currentDragOperation;var b=h.CreateDragEventFromTouch(this.lastTouchEvent,"dragend",!1,this.doc.defaultView,this.dataTransfer,null),c=!a.dispatchEvent(b);return this.dragDataStore.mode=d._DISCONNECTED,c},a.prototype.drop=function(a){this.config.log("drop"),this.dragDataStore.mode=d.READONLY,this.dataTransfer.dropEffect=this.currentDragOperation;var b=h.CreateDragEventFromTouch(this.lastTouchEvent,"drop",!1,this.doc.defaultView,this.dataTransfer,null),c=!a.dispatchEvent(b);return this.dragDataStore.mode=d._DISCONNECTED,c},a.transform_css_vendor_prefixes=["","-webkit-"],a.transform_css_regex=/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,a}(),f=function(){function a(a){this.dataStore=a,this._dropEffect="none"}return Object.defineProperty(a.prototype,"files",{get:function(){return this.dataStore.mode===d._DISCONNECTED,null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"items",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"types",{get:function(){return this.dataStore.mode===d._DISCONNECTED?null:Object.freeze(this.dataStore.types)},enumerable:!0,configurable:!0}),a.prototype.setData=function(a,b){if(this.dataStore.mode!==d._DISCONNECTED&&this.dataStore.mode===d.READWRITE){if(a.indexOf(" ")>-1)throw new Error("Space character not allowed in drag data item type string");this.dataStore.data[a]=b;var c=this.dataStore.types.indexOf(a);c>-1&&this.dataStore.types.push(a)}},a.prototype.getData=function(a){return this.dataStore.mode===d._DISCONNECTED?null:this.dataStore.mode===d.PROTECTED?null:this.dataStore.data[a]||""},a.prototype.clearData=function(a){if(this.dataStore.mode!==d._DISCONNECTED){if(a&&this.dataStore.data[a]){delete this.dataStore.data[a];var b=this.dataStore.types.indexOf(a);return void(b>-1&&this.dataStore.types.splice(b,1))}this.dataStore.data={},this.dataStore.types=[]}},a.prototype.setDragImage=function(a,b,c){return this.dataStore.mode===d._DISCONNECTED?null:void 0},Object.defineProperty(a.prototype,"effectAllowed",{get:function(){return this.dataStore.effectAllowed},set:function(b){this.dataStore.mode!==d._DISCONNECTED&&-1!==a.AllowedEffects.indexOf(b)&&(this.dataStore.effectAllowed=b)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(b){this.dataStore.mode!==d._DISCONNECTED&&-1!==a.DropEffects.indexOf(b)&&(this._dropEffect=b)},enumerable:!0,configurable:!0}),a.AllowedEffects=["none","copy","copyLink","copyMove","link","linkMove","move","all"],a.DropEffects=["none","copy","move","link"],a}();!function(a){a[a._DISCONNECTED=0]="_DISCONNECTED",a[a.READONLY=1]="READONLY",a[a.READWRITE=2]="READWRITE",a[a.PROTECTED=3]="PROTECTED"}(d||(d={}));var g=function(){function a(){this.mode=d.PROTECTED,this.data={},this.types=[],this.effectAllowed="uninitialized"}return a}(),h=function(){function a(){}return a.ForIn=function(a,b){for(var c in a)a.hasOwnProperty(c)!==!1&&b(a[c],c)},a.Merge=function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)!==!1&&(a[c]=b[c])},a.Average=function(a){return 0===a.length?0:a.reduce(function(a,b){return b+a},0)/a.length},a.IsDOMElement=function(a){return a&&a.tagName},a.IsTouchIdentifierContainedInTouchEvent=function(a,b){for(var c=0;c<a.changedTouches.length;c++){var d=a.changedTouches[c];if(d.identifier===b)return!0}return!1},a.GetTouchContainedInTouchEventByIdentifier=function(a,b){for(var c=0;c<a.changedTouches.length;c++){var d=a.changedTouches[c];if(d.identifier===b)return d}return null},a.CreateMouseEventFromTouch=function(a,b,c,d,e){void 0===c&&(c=!0),void 0===d&&(d=document.defaultView),void 0===e&&(e=null);var f=document.createEvent("MouseEvents"),g=a.changedTouches[0];return f.initMouseEvent(b,!0,c,d,1,g.screenX,g.screenY,g.clientX,g.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,e),f},a.CreateDragEventFromTouch=function(a,b,c,d,e,f){void 0===f&&(f=null);var g=a.changedTouches[0],h=document.createEvent("Event");return h.initEvent(b,!0,c),h.dataTransfer=e,h.relatedTarget=f,h.screenX=g.screenX,h.screenY=g.screenY,h.clientX=g.clientX,h.clientY=g.clientY,h},a.ElementFromTouch=function(a,b){var c=a.elementFromPoint(b.clientX,b.clientY);return c},a}()}(MobileDragAndDropPolyfill||(MobileDragAndDropPolyfill={}));
//# sourceMappingURL=mobile-drag-and-drop-polyfill.min.map